---
import Layout from '../../layouts/Layout.astro';
import ky from 'ky';

// console.log('Astro url => ', Astro.url.origin)
type Tables = {
  table_name: string;
}

type Table = {
  id: number;
  brand_name: string;
  size_icon_logo: string;
}

type Data = {
  message: string;
  success: boolean;
  data: Tables[]
}

interface DataTable {
  message: string;
  success: boolean;
  data: Table[]
}

const { table } = Astro.params;
console.log('astro params => ', Astro.params)

const tables = await ky.get<Data>(`${Astro.url.origin}/api/tables/read`).json();
console.log('tables => ', tables.data)

const dataTable = await ky.get<DataTable>(`${Astro.url.origin}/api/read/${table}`).json();
console.log('table clicked => ', dataTable)
const columns = dataTable.data.length > 0 ? Object.keys(dataTable.data[0]) : [];

---

<Layout>
  <section class="grid grid-cols-12">
    <div class="col-span-3 px-2 py-4 bg-red-100 w-full min-h-screen overflow-y-auto">
      <ul>
        {tables && tables.data.map((table: Tables) => {
          return (
          <li>
            <a href={`/table/${table.table_name}`}>{table.table_name}</a>
          </li>
          )
        })}
      </ul>
    </div>
    <div class="col-span-9 px-2 py-4 bg-green-100 w-full min-h-screen">
      <!-- <ul>
        {dataTable && dataTable.data.map((table: Table) => {
          return (
          <li>{table.brand_name}</li>
          )
        })}
      </ul>  -->
      <table class="w-full border-collapse">
        <thead>
          <tr>
            {columns.map(col => <th class="border p-2 bg-gray-100">{col}</th>)}
          </tr>
        </thead>
        <tbody>
          {dataTable.data.map((row: any, i: number) => 
            <tr class={i % 2 === 0 ? "bg-gray-50" : ""}>
              {columns.map(col => 
                <td class="border p-2">
                  {row[col] === null ? <i>null</i> : String(row[col])}
                </td>
              )}
            </tr>
          )}
        </tbody>
      </table>
    </div>
  </section>
</Layout>
